<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Channel Scraper Pro</title>
    <style>
        :root {
            --color-primary: #ff0000;
            --color-primary-hover: #cc0000;
            --color-bg: #0f0f0f;
            --color-surface: #212121;
            --color-text: #ffffff;
            --color-text-secondary: #aaaaaa;
            --color-border: #303030;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--color-bg); color: var(--color-text);
            padding: 20px; min-height: 100vh;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header {
            text-align: center; margin-bottom: 40px;
            border-bottom: 2px solid var(--color-border);
            padding-bottom: 20px;
        }
        h1 { font-size: 2.5em; margin-bottom: 10px; color: var(--color-primary);}
        .subtitle { color: var(--color-text-secondary); font-size: 1.1em;}
        .main-section {
            display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;
        }
        @media (max-width: 768px) {.main-section {grid-template-columns: 1fr;}}
        .card {
            background: var(--color-surface); border: 1px solid var(--color-border);
            border-radius: 8px; padding: 25px;
        }
        .card h2 { font-size: 1.3em; margin-bottom: 20px; color: var(--color-primary);}
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--color-text);}
        input, textarea, select {
            width: 100%; padding: 10px 12px; border: 1px solid var(--color-border);
            background: var(--color-bg); color: var(--color-text); border-radius: 4px;
            font-family: inherit; font-size: 1em;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(255, 0, 0, 0.1);
        }
        textarea { resize: vertical; min-height: 100px; font-family: 'Courier New', monospace; font-size: 0.9em; }
        .button-group { display: flex; gap: 10px; flex-wrap: wrap; }
        button {
            padding: 12px 24px; border: none; border-radius: 4px; font-size: 1em;
            font-weight: 600; cursor: pointer; transition: all 0.2s;
        }
        .btn-primary {
            background: var(--color-primary); color: white; flex: 1; min-width: 120px;
        }
        .btn-primary:hover { background: var(--color-primary-hover); transform: translateY(-2px);}
        .btn-primary:active { transform: translateY(0);}
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-secondary {
            background: var(--color-surface);
            color: var(--color-primary); border: 1px solid var(--color-primary);
        }
        .btn-secondary:hover { background: rgba(255, 0, 0, 0.1); }
        .btn-small { padding: 8px 16px; font-size: 0.9em;}
        .status-message { padding: 15px; border-radius: 4px; margin-bottom: 15px; display: none;}
        .status-message.show { display: block; }
        .status-message.success { background: rgba(0, 176, 80, 0.2); border: 1px solid #00b050; color: #00b050; }
        .status-message.error   { background: rgba(255, 68, 68, 0.2); border: 1px solid #ff4444; color: #ff4444;}
        .status-message.info { background: rgba(255, 0, 0, 0.1); border: 1px solid var(--color-primary); color: var(--color-primary);}
        .videos-list { max-height: 500px; overflow-y: auto; border: 1px solid var(--color-border); border-radius: 4px; margin-bottom: 15px;}
        .video-item { padding: 12px; border-bottom: 1px solid var(--color-border); display: flex; justify-content: space-between; align-items: center; gap: 10px;}
        .video-item:last-child { border-bottom: none;}
        .video-info { flex: 1; min-width: 0;}
        .video-title { color: var(--color-primary); text-decoration: none; font-weight: 500; word-break: break-word; display: block; margin-bottom: 4px;}
        .video-title:hover {text-decoration: underline;}
        .video-meta { color: var(--color-text-secondary); font-size: 0.85em;}
        .btn-copy {
            padding: 6px 12px; background: var(--color-border); color: var(--color-text); border: none; border-radius: 3px; cursor: pointer; font-size: 0.85em;
        }
        .btn-copy:hover { background: var(--color-primary);}
        .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;}
        .stat-box { background: var(--color-bg); border: 1px solid var(--color-border); padding: 15px; border-radius: 4px; text-align: center;}
        .stat-number { font-size: 2em; font-weight: bold; color: var(--color-primary); margin-bottom: 5px;}
        .stat-label { color: var(--color-text-secondary); font-size: 0.9em;}
        .export-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 10px;}
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--color-border);
            color: var(--color-text-secondary);
            font-size: 0.85em;
        }
        .copyright {
            margin-bottom: 10px;
            font-weight: 500;
        }
        .license-info { margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--color-border); font-size: 0.8em;}
        .theme-toggle { position: fixed; top: 20px; right: 20px; background: var(--color-surface); border: 1px solid var(--color-border); padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 0.9em; z-index: 1000;}
        .theme-toggle:hover { background: var(--color-primary); }
        .controls-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px;}
        @media (max-width: 768px) { .controls-row { grid-template-columns: 1fr;}}
        .search-box { width: 100%; padding: 10px 12px; border: 1px solid var(--color-border); background: var(--color-bg); color: var(--color-text); border-radius: 4px; font-size: 0.95em;}
        [data-theme="light"] {
            --color-primary: #0066cc;
            --color-primary-hover: #0052a3;
            --color-bg: #ffffff;
            --color-surface: #f5f5f5;
            --color-text: #1a1a1a;
            --color-text-secondary: #666666;
            --color-border: #cccccc;
        }

        /* ===== –ö–í–û–¢–ê ===== */
        .quota-container {
            background: var(--color-surface); border: 1px solid var(--color-border);
            border-radius: 8px; padding: 20px; margin-bottom: 20px; text-align: center;
        }
        .quota-label { font-size: 0.9em; color: var(--color-text-secondary); margin-bottom: 8px; }
        .quota-bar { width: 100%; height: 24px; background: var(--color-bg); border: 1px solid var(--color-border); border-radius: 4px; overflow: hidden; margin-bottom: 10px;}
        .quota-fill {
            height: 100%; background: linear-gradient(90deg, #00b050 0%, #ffc000 70%, #ff4444 100%);
            transition: width 0.3s ease; display: flex; align-items: center; justify-content: center;
            font-size: 0.8em; color: white; font-weight: bold;
        }
        .quota-text { font-size: 1em; color: var(--color-text); margin-bottom: 5px; }
        .quota-reset { font-size: 0.85em; color: var(--color-text-secondary); }

        .license-banner {
            background: rgba(255, 100, 0, 0.1); border: 1px solid var(--color-primary);
            border-radius: 8px; padding: 15px; margin-bottom: 20px;
            font-size: 0.85em; color: var(--color-text-secondary); line-height: 1.6;
        }
        .license-banner strong { color: var(--color-text);}
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()">üåô Dark</button>
    <div class="container">
        <header>
            <h1>üé¨ YouTube Channel Scraper Pro</h1>
            <p class="subtitle">–ü–æ–ª—É—á–∏ –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ –ª—é–±–æ–≥–æ YouTube –∫–∞–Ω–∞–ª–∞ —Å –ø–æ–∏—Å–∫–æ–º –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π</p>
        </header>

        <!-- –ö–í–û–¢–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø -->
        <div class="quota-container" id="quotaContainer">
            <div class="quota-label">üìä –ú–û–Ø –ö–í–û–¢–ê –ù–ê –°–ï–ì–û–î–ù–Ø</div>
            <div class="quota-bar">
                <div class="quota-fill" id="quotaFill" style="width: 0%">
                    <span id="quotaPercent">0%</span>
                </div>
            </div>
            <div class="quota-text" id="quotaText">0 / 5 –∑–∞–ø—Ä–æ—Å–æ–≤</div>
            <div class="quota-reset" id="quotaReset">–°–±—Ä–æ—Å –≤ 00:00 MSK</div>
        </div>

        <!-- –õ–ò–¶–ï–ù–ó–ò–û–ù–ù–û–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–ï -->
        <div class="license-banner">
            <strong>‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:</strong><br>
            ¬© 2025 YouTube Channel Scraper Pro. –ê–≤—Ç–æ—Ä—Å–∫–æ–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ.<br>
            <strong>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:</strong> –ë–µ—Å–ø–ª–∞—Ç–Ω–æ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥–ª—è –≥—Ä—É–ø–ø—ã –∏–∑ 20 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.<br>
            <strong>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:</strong> 5 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç 10,000 –µ–¥–∏–Ω–∏—Ü/–¥–µ–Ω—å.<br>
            <strong>–ö–æ–º–º–µ—Ä—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:</strong> –¢—Ä–µ–±—É–µ—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è —Å –∞–≤—Ç–æ—Ä–æ–º –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –ª–∏—Ü–µ–Ω–∑–∏–∏.
        </div>

        <div class="main-section">
            <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –í–≤–æ–¥ -->
            <div class="card">
                <h2>üì• –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö</h2>
                <div class="form-group">
                    <label for="channelId">Channel ID –∏–ª–∏ URL *</label>
                    <input type="text" id="channelId" placeholder="UCIFfUtMRKPG8sGk6d6a_lzQ –∏–ª–∏ https://youtube.com/channel/...">
                </div>
                <div class="form-group">
                    <label for="format">–§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞</label>
                    <select id="format">
                        <option value="json">JSON</option>
                        <option value="csv">CSV</option>
                        <option value="txt">Text (—Å–ø–∏—Å–æ–∫ —Å—Å—ã–ª–æ–∫)</option>
                    </select>
                </div>
                <div class="status-message" id="statusMessage"></div>
                <div class="button-group">
                    <button class="btn-primary" id="loadBtn" onclick="fetchVideos()">
                        <span id="btnText">üé¨ –ó–∞–≥—Ä—É–∑–∏—Ç—å</span>
                    </button>
                    <button class="btn-secondary btn-small" onclick="showApiHelp()">?</button>
                </div>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –ü—Ä–∏–º–µ—Ä -->
            <div class="card">
                <h2>‚ÑπÔ∏è –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</h2>
                <p style="margin-bottom: 15px; color: var(--color-text-secondary);">
                    –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç YouTube Data API v3 –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –≤–∏–¥–µ–æ —Å –∫–∞–Ω–∞–ª–∞. –í–∞—à API –∫–ª—é—á –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.
                </p>
                <h3 style="color: var(--color-text); font-size: 1em; margin-bottom: 10px;">–®–∞–≥–∏:</h3>
                <ol style="color: var(--color-text-secondary); line-height: 1.8; margin-left: 20px;">
                    <li>–í—Å—Ç–∞–≤—å Channel ID –∏–ª–∏ URL –∫–∞–Ω–∞–ª–∞</li>
                    <li>–ù–∞–∂–º–∏ ¬´–ó–∞–≥—Ä—É–∑–∏—Ç—å¬ª (–ª–∏–º–∏—Ç 5/–¥–µ–Ω—å)</li>
                    <li>–í—ã–±–µ—Ä–∏ —Ñ–æ—Ä–º–∞—Ç ‚Äî —Å–∫–∞—á–∞–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</li>
                </ol>
                <div style="background: var(--color-bg); padding: 15px; border-radius: 4px; margin-top: 15px;">
                    <p style="color: var(--color-text-secondary); margin-bottom: 8px;"><strong>–ü—Ä–∏–º–µ—Ä Channel ID:</strong></p>
                    de style="color: var(--color-primary);">UCIFfUtMRKPG8sGk6d6a_lzQ</code>
                </div>
            </div>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
        <div class="card">
            <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
            <div class="stats" id="statsContainer" style="display: none;">
                <div class="stat-box">
                    <div class="stat-number" id="totalVideos">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –≤–∏–¥–µ–æ</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="channelName">-</div>
                    <div class="stat-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞</div>
                </div>
            </div>
            <div id="videosContainer" style="display: none;">
                <div class="controls-row">
                    <input type="text" id="searchInput" class="search-box" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –≤–∏–¥–µ–æ..." onkeyup="filterAndSortVideos()">
                    <select id="sortSelect" class="search-box" onchange="filterAndSortVideos()">
                        <option value="newest">–ù–æ–≤—ã–µ —Å–Ω–∞—á–∞–ª–∞</option>
                        <option value="oldest">–°—Ç–∞—Ä—ã–µ —Å–Ω–∞—á–∞–ª–∞</option>
                        <option value="title-asc">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–ê-–Ø)</option>
                        <option value="title-desc">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–Ø-–ê)</option>
                    </select>
                    <button class="btn-primary" onclick="clearFilters()" style="min-width: auto;">üîÑ –°–±—Ä–æ—Å</button>
                </div>
                <h3 style="margin-bottom: 15px; color: var(--color-text);">
                    –í–∏–¥–µ–æ –Ω–∞ –∫–∞–Ω–∞–ª–µ: <span id="videoCount"></span>
                </h3>
                <div class="videos-list" id="videosList"></div>
                <div class="export-buttons">
                    <button class="btn-primary" onclick="exportData('json')">üì• JSON</button>
                    <button class="btn-primary" onclick="exportData('csv')">üì• CSV</button>
                    <button class="btn-primary" onclick="exportData('txt')">üì• TXT</button>
                    <button class="btn-secondary" onclick="copyAllLinks()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫–∏</button>
                </div>
            </div>
            <div id="noResults" style="text-align: center; padding: 40px; color: var(--color-text-secondary);">
                <p>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏</p>
            </div>
        </div>

        <footer class="footer">
            <div class="copyright">
                ¬© 2025 YouTube Channel Scraper Pro v3.0 | –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã
            </div>
            <p style="margin-top: 10px; font-size: 0.8em;">
                üîê API –∫–ª—é—á –∑–∞—â–∏—â–µ–Ω | üìä –ö–≤–æ—Ç–∞: 5 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å | üåô Dark/Light —Ä–µ–∂–∏–º—ã
            </p>
            <div class="license-info">
                <p>‚ö†Ô∏è –õ–ò–¶–ï–ù–ó–ò–Ø: –ê–≤—Ç–æ—Ä—Å–∫–æ–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ. –ë–µ—Å–ø–ª–∞—Ç–Ω–æ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ. –ü—Ä–∏ –∫–æ–º–º–µ—Ä—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ.</p>
            </div>
        </footer>
    </div>

    <script>
    // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ==========
    const BACKEND_URL = '/api/videos'; // –∏–ª–∏ https://your-vercel-domain/api/videos
    const QUOTA_LIMIT = 5;
    
    // ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
    let allVideos = [];
    let filteredVideos = [];
    let channelData = {};

    // ========== –ö–í–û–¢–ê ==========
    function checkAndResetQuota() {
        const today = new Date().toISOString().split('T')[0];
        const lastQuotaDate = localStorage.getItem('quota_date');
        if (lastQuotaDate !== today) {
            localStorage.setItem('quota_date', today);
            localStorage.setItem('quota_used', '0');
        }
    }

    function getQuotaInfo() {
        const used = parseInt(localStorage.getItem('quota_used') || 0);
        const remaining = QUOTA_LIMIT - used;
        const percent = Math.round((used / QUOTA_LIMIT) * 100);
        return { used, remaining, percent };
    }

    function displayQuotaInfo() {
        const { used, remaining, percent } = getQuotaInfo();
        document.getElementById('quotaFill').style.width = percent + '%';
        document.getElementById('quotaPercent').textContent = percent + '%';
        document.getElementById('quotaText').textContent = `${used} / ${QUOTA_LIMIT} –∑–∞–ø—Ä–æ—Å–æ–≤`;
        
        const quotaFill = document.getElementById('quotaFill');
        if (percent < 60) quotaFill.style.background = 'linear-gradient(90deg, #00b050 0%, #00b050 100%)';
        else if (percent < 80) quotaFill.style.background = 'linear-gradient(90deg, #ffc000 0%, #ffc000 100%)';
        else quotaFill.style.background = 'linear-gradient(90deg, #ff4444 0%, #ff4444 100%)';
        
        const button = document.getElementById('loadBtn');
        if (remaining <= 0) { 
            button.disabled = true; 
            button.textContent = '‚ùå –õ–∏–º–∏—Ç –¥–æ—Å—Ç–∏–≥–Ω—É—Ç'; 
        }
        else if (remaining === 1) { 
            button.style.borderColor = '#ff4444'; 
            button.textContent = `‚ö†Ô∏è –û—Å—Ç–∞–ª–æ—Å—å ${remaining} –∑–∞–ø—Ä–æ—Å`; 
        }
        else { 
            button.disabled = false; 
            button.textContent = `üé¨ –ó–∞–≥—Ä—É–∑–∏—Ç—å (${remaining} –æ—Å—Ç–∞–ª–æ—Å—å)`;
        }
    }

    function incrementQuota() {
        const used = parseInt(localStorage.getItem('quota_used') || 0);
        localStorage.setItem('quota_used', (used + 1).toString());
        displayQuotaInfo();
    }

    // ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï CHANNEL ID ==========
    function extractChannelId(input) {
        // –£–∂–µ Channel ID?
        if (input.startsWith('UC') && input.length === 24) return input;
        
        // youtube.com/@username
        if (input.includes('youtube.com/@')) {
            return input.split('@')[1].split('/')[0].split('?')[0];
        }
        
        // youtube.com/c/username
        if (input.includes('youtube.com/c/')) {
            return input.split('/c/')[1].split('/')[0].split('?')[0];
        }
        
        // youtube.com/channel/UC...
        if (input.includes('youtube.com/channel/')) {
            return input.split('/channel/')[1].split('/')[0].split('?')[0];
        }
        
        return null;
    }

    // ========== –ó–ê–ì–†–£–ó–ö–ê –í–ò–î–ï–û ==========
    async function fetchVideos() {
        const quota = getQuotaInfo();
        if (quota.remaining <= 0) {
            showStatus('‚ùå –õ–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å—á–µ—Ä–ø–∞–Ω. –ü—Ä–∏—Ö–æ–¥–∏—Ç–µ –∑–∞–≤—Ç—Ä–∞!', 'error');
            return;
        }
        
        const channelInput = document.getElementById('channelId').value.trim();
        if (!channelInput) {
            showStatus('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ Channel ID –∏–ª–∏ URL', 'error');
            return;
        }
        
        try {
            const channelId = extractChannelId(channelInput);
            if (!channelId) {
                showStatus('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π Channel ID –∏–ª–∏ URL', 'error');
                return;
            }
            
            showStatus('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ...', 'info');
            document.getElementById('loadBtn').disabled = true;
            
            // ‚úÖ –í–´–ó–´–í–ê–ï–ú BACKEND, –ê –ù–ï YOUTUBE API!
            const response = await fetch(BACKEND_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ channelId: channelId })
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
            }
            
            const data = await response.json();
            allVideos = data.videos || [];
            channelData = data.channel || {};
            
            incrementQuota();
            displayResults();
            showStatus(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${allVideos.length} –≤–∏–¥–µ–æ!`, 'success');
            
        } catch (error) {
            showStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
        } finally {
            document.getElementById('loadBtn').disabled = false;
        }
    }

    // ========== –ü–û–ö–ê–ó –°–¢–ê–¢–£–°-–°–û–û–ë–©–ï–ù–ò–Ø ==========
    function showStatus(message, type = 'info') {
        const el = document.getElementById('statusMessage');
        if (!el) return;
        
        el.className = `status-message show ${type}`;
        el.textContent = message;
        
        // –ê–≤—Ç–æ—Å–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ 3 —Å–µ–∫ –¥–ª—è —É—Å–ø–µ—Ö–∞
        if (type === 'success') {
            setTimeout(() => el.classList.remove('show'), 3000);
        }
    }

    // ========== –ü–û–ö–ê–ó –†–ï–ó–£–õ–¨–¢–ê–¢–û–í ==========
    function displayResults() {
        const statsContainer = document.getElementById('statsContainer');
        const videosContainer = document.getElementById('videosContainer');
        const noResults = document.getElementById('noResults');
        
        if (!allVideos || allVideos.length === 0) {
            statsContainer.style.display = 'none';
            videosContainer.style.display = 'none';
            noResults.style.display = 'block';
            return;
        }
        
        document.getElementById('totalVideos').textContent = allVideos.length;
        document.getElementById('channelName').textContent = channelData.name || '-';
        
        statsContainer.style.display = 'grid';
        videosContainer.style.display = 'block';
        noResults.style.display = 'none';
        
        filterAndSortVideos();
    }

    // ========== –ó–ê–©–ò–¢–ê –û–¢ XSS ==========
    function escapeHtml(text) {
        const map = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#039;'
        };
        return text.replace(/[&<>"']/g, m => map[m]);
    }

    // ========== –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –í–ò–î–ï–û ==========
    function displayFilteredResults() {
        const videosList = document.getElementById('videosList');
        videosList.innerHTML = '';
        document.getElementById('videoCount').textContent = `${filteredVideos.length}/${allVideos.length}`;
        
        if (filteredVideos.length === 0) {
            videosList.innerHTML = '<p style="color: var(--color-text-secondary); padding: 20px;">–í–∏–¥–µ–æ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
            return;
        }
        
        videosList.innerHTML = filteredVideos.map((v, i) => `
            <div class="video-item">
                <div class="video-info">
                    <a href="${v.url}" target="_blank" class="video-title">${i + 1}. ${escapeHtml(v.title)}</a>
                    <div class="video-meta">${new Date(v.publishedAt).toLocaleDateString('ru-RU')} ‚Ä¢ ${v.id}</div>
                </div>
                <button class="btn-copy" onclick="copyToClipboard('${v.url}')">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
        `).join('');
    }

    // ========== –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –ò –°–û–†–¢–ò–†–û–í–ö–ê ==========
    function filterAndSortVideos() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const sortType = document.getElementById('sortSelect').value;
        
        filteredVideos = allVideos.filter(video => video.title.toLowerCase().includes(searchTerm));
        
        filteredVideos.sort((a, b) => {
            switch(sortType) {
                case 'newest': return new Date(b.publishedAt) - new Date(a.publishedAt);
                case 'oldest': return new Date(a.publishedAt) - new Date(b.publishedAt);
                case 'title-asc': return a.title.localeCompare(b.title);
                case 'title-desc': return b.title.localeCompare(a.title);
                default: return 0;
            }
        });
        
        displayFilteredResults();
    }

    // ========== –°–ë–†–û–° –§–ò–õ–¨–¢–†–û–í ==========
    function clearFilters() {
        document.getElementById('searchInput').value = '';
        document.getElementById('sortSelect').value = 'newest';
        filterAndSortVideos();
    }

    // ========== –≠–ö–°–ü–û–†–¢ –î–ê–ù–ù–´–• ==========
    function exportData(format) {
        if (!allVideos || allVideos.length === 0) {
            showStatus('‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'error');
            return;
        }
        
        let content, filename, type;
        
        switch(format) {
            case 'json':
                content = JSON.stringify({
                    channel: channelData,
                    videos: allVideos,
                    exportDate: new Date().toISOString()
                }, null, 2);
                filename = 'youtube-videos.json';
                type = 'application/json';
                break;
            
            case 'csv':
                content = '–ù–æ–º–µ—Ä,–ù–∞–∑–≤–∞–Ω–∏–µ,URL,–î–∞—Ç–∞,ID\n';
                allVideos.forEach((v, i) => {
                    content += `"${i + 1}","${v.title.replace(/"/g, '""')}","${v.url}","${v.publishedAt}","${v.id}"\n`;
                });
                filename = 'youtube-videos.csv';
                type = 'text/csv';
                break;
            
            case 'txt':
                content = `–ö–∞–Ω–∞–ª: ${channelData.name}\n`;
                content += `–í–∏–¥–µ–æ: ${allVideos.length}\n`;
                content += `–î–∞—Ç–∞: ${new Date().toLocaleString('ru-RU')}\n\n`;
                allVideos.forEach((v, i) => {
                    content += `${i + 1}. ${v.title}\n${v.url}\n${v.publishedAt}\n\n`;
                });
                filename = 'youtube-videos.txt';
                type = 'text/plain';
                break;
            
            default: return;
        }
        
        const blob = new Blob([content], { type });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
        
        showStatus(`‚úÖ –§–∞–π–ª ${filename} —Å–∫–∞—á–∞–Ω!`, 'success');
    }

    // ========== –ö–û–ü–ò–†–û–í–ê–ù–ò–ï –í–°–ï–• –°–°–´–õ–û–ö ==========
    function copyAllLinks() {
        if (!allVideos || allVideos.length === 0) return;
        
        const links = allVideos.map((v, i) => `${i + 1}. ${v.title}\n${v.url}`).join('\n\n');
        navigator.clipboard.writeText(links).then(() => {
            showStatus('‚úÖ –°—Å—ã–ª–∫–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä!', 'success');
        });
    }

    // ========== –ö–û–ü–ò–†–û–í–ê–ù–ò–ï –û–î–ù–û–ô –°–°–´–õ–ö–ò ==========
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            showStatus('‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!', 'success');
        });
    }

    // ========== –°–ü–†–ê–í–ö–ê –û –ü–†–ò–õ–û–ñ–ï–ù–ò–ò ==========
    function showApiHelp() {
        alert(`‚ÑπÔ∏è –û –ü–†–ò–õ–û–ñ–ï–ù–ò–ò:\n\nüîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨: API –∫–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–Ω–µ –≤–∏–¥–∏–º –≤ –±—Ä–∞—É–∑–µ—Ä–µ)\n\nüìä –ö–í–û–¢–´:\n‚Ä¢ 5 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n‚Ä¢ 10,000 –µ–¥–∏–Ω–∏—Ü –≤ –¥–µ–Ω—å (–≥–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç)\n‚Ä¢ –°–±—Ä–æ—Å –∫–≤–æ—Ç—ã –≤ 00:00 MSK\n\n‚ö†Ô∏è –õ–ò–¶–ï–ù–ó–ò–Ø:\n‚Ä¢ ¬© 2025 YouTube Channel Scraper Pro\n‚Ä¢ –ê–≤—Ç–æ—Ä—Å–∫–æ–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ\n‚Ä¢ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥–ª—è –≥—Ä—É–ø–ø—ã\n‚Ä¢ –ü—Ä–∏ –∫–æ–º–º–µ—Ä—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ`);
    }

    // ========== –°–ú–ï–ù–ê –¢–ï–ú–´ ==========
    function toggleTheme() {
        const html = document.documentElement;
        const currentTheme = html.getAttribute('data-theme') || 'dark';
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        document.querySelector('.theme-toggle').textContent = newTheme === 'dark' ? '‚òÄÔ∏è Light' : 'üåô Dark';
    }

    function initTheme() {
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
        document.querySelector('.theme-toggle').textContent = savedTheme === 'dark' ? '‚òÄÔ∏è Light' : 'üåô Dark';
    }

    // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
    document.addEventListener('DOMContentLoaded', () => {
        initTheme();
        checkAndResetQuota();
        displayQuotaInfo();
    });
    </script>
</body>
</html>
